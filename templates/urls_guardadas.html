{% extends 'base.html' %}
{% block title %}URLs Guardadas | PrestaLabs{% endblock %}
{% block content %}
<div class="container-xl py-3">
	<div class="row mb-4">
		<div class="col-12">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h2 class="fw-bold text-dark">
					<i class="bi bi-bookmark-heart me-2"></i>URLs Guardadas
				</h2>
				<div class="d-flex align-items-center">
					<span class="badge bg-primary">{{ total_guardadas }} URL{{ total_guardadas|pluralize }}</span>
					<a href="{% url 'analisis_dominio' %}" class="btn btn-outline-primary btn-sm ms-2">
						<i class="bi bi-arrow-left me-1"></i>Volver al análisis
					</a>
				</div>
			</div>

			{% if total_guardadas > 0 %}
				<div class="card shadow-sm">
					<div class="card-body p-0">
						<div class="table-responsive">
							<table class="table table-hover mb-0" style="font-size:0.9em;">
								<thead class="table-light">
									<tr>
										<th class="fw-bold">URL</th>
										<th class="fw-bold text-center">Dominio</th>
										<th class="fw-bold text-center">Fecha guardada</th>
										<th class="fw-bold text-center">Notas</th>
										<th class="text-center">Acciones</th>
									</tr>
								</thead>
								<tbody>
									{% for url_guardada in urls_guardadas %}
										<tr>
											<td class="align-middle">
												<div class="d-flex align-items-center">
													<i class="bi bi-bookmark-fill text-warning me-2"></i>
													<div>
														<div class="fw-semibold text-primary text-break" style="max-width: 400px;">
															<a href="{{ url_guardada.url }}" target="_blank" class="text-decoration-none">
																{{ url_guardada.url }}
																<i class="bi bi-box-arrow-up-right ms-1" style="font-size: 0.8em;"></i>
															</a>
														</div>
														{% if url_guardada.titulo %}
															<small class="text-muted">{{ url_guardada.titulo }}</small>
														{% endif %}
													</div>
												</div>
											</td>
											<td class="text-center align-middle">
												<span class="badge bg-info">{{ url_guardada.dominio }}</span>
											</td>
											<td class="text-center align-middle">
												<small class="text-muted">
													{{ url_guardada.created_at|date:"d/m/Y H:i" }}
												</small>
											</td>
											<td class="text-center align-middle">
												{% if url_guardada.notas %}
													<small class="text-muted" style="max-width: 200px; display: inline-block;">
														{{ url_guardada.notas|truncatechars:50 }}
													</small>
												{% else %}
													<small class="text-muted">-</small>
												{% endif %}
											</td>
											<td class="text-center align-middle">
												<div class="dropdown">
													<button class="btn btn-light btn-sm dropdown-toggle px-2 py-1" type="button" id="accionesDropdown{{ url_guardada.id }}" data-bs-toggle="dropdown" aria-expanded="false">
														<i class="bi bi-three-dots-vertical" style="font-size:1.3em;"></i>
													</button>
													<ul class="dropdown-menu" aria-labelledby="accionesDropdown{{ url_guardada.id }}">
														<li>
															<a class="dropdown-item d-flex align-items-center" href="{{ url_guardada.url }}" target="_blank">
																<i class="bi bi-box-arrow-up-right me-2 text-primary"></i> Abrir URL
															</a>
														</li>
														<li>
															<a class="dropdown-item d-flex align-items-center" href="/analisis/detalle/?id={{ url_guardada.busqueda_dominio.id }}">
																<i class="bi bi-eye me-2 text-info"></i> Ver análisis completo
															</a>
														</li>
														<li>
															<form method="post" style="display:inline;">
																{% csrf_token %}
																<button type="submit" name="desmarcar_url_guardada" value="{{ url_guardada.id }}" class="dropdown-item d-flex align-items-center">
																	<i class="bi bi-bookmark-dash me-2 text-warning"></i> Desmarcar guardada
																</button>
															</form>
														</li>
													</ul>
												</div>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
				</div>

				<!-- Paginación -->
				{% if page_obj.has_other_pages %}
					<nav aria-label="Navegación de URLs guardadas" class="mt-4">
						<ul class="pagination justify-content-center">
							{% if page_obj.has_previous %}
								<li class="page-item">
									<a class="page-link" href="?page=1">Primera</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
								</li>
							{% endif %}

							<li class="page-item active">
								<span class="page-link">
									Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
								</span>
							</li>

							{% if page_obj.has_next %}
								<li class="page-item">
									<a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
								</li>
								<li class="page-item">
									<a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Última</a>
								</li>
							{% endif %}
						</ul>
					</nav>
				{% endif %}
			{% else %}
				<!-- Estado vacío -->
				<div class="card border-0 bg-light">
					<div class="card-body text-center py-5">
						<div class="mb-4">
							<i class="bi bi-bookmark-heart text-muted" style="font-size: 4rem;"></i>
						</div>
						<h4 class="text-muted mb-3">No hay URLs guardadas</h4>
						<p class="text-muted mb-4">
							Aún no has marcado ninguna URL como guardada.<br>
							Ve al detalle de un dominio analizado y guarda las URLs que te interesen.
						</p>
						<a href="{% url 'analisis_dominio' %}" class="btn btn-primary">
							<i class="bi bi-search me-2"></i>Ir al análisis de dominios
						</a>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
</div>
{% endblock %}