<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}PrestaLabs{% endblock %}</title>
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'css/popups.css' %}">
</head>
<body>
    {% include "base/navbar.html" %}

    <main class="container mt-4">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        {% block content %}
        {% endblock %}
    </main>
    <!-- Sistema Centralizado de Modales -->
    <!-- Modal Universal para Confirmación -->
    <div class="modal fade" id="modalConfirmacion" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalConfirmacionTitulo">
                        <i class="bi bi-question-circle me-2"></i>
                        Confirmación
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalConfirmacionMensaje">¿Está seguro de realizar esta acción?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btnCancelar">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnConfirmar">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Universal para Alertas/Información -->
    <div class="modal fade" id="modalAlerta" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalAlertaTitulo">
                        <i class="bi bi-info-circle me-2"></i>
                        Información
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalAlertaMensaje">Mensaje de información</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="btnAlertaOK">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Universal para Éxito -->
    <div class="modal fade" id="modalExito" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalExitoTitulo">
                        <i class="bi bi-check-circle me-2"></i>
                        Éxito
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalExitoMensaje">Operación completada exitosamente</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="btnExitoOK">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Universal para Errores -->
    <div class="modal fade" id="modalError" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalErrorTitulo">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Error
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modalErrorMensaje">Ha ocurrido un error</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="btnErrorOK">OK</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Sistema de Gestión de Popups Universal -->
    <script>
    /**
     * Sistema Centralizado de Popups - PrestaLabs
     * Autor: Sistema robusto y escalable
     * Reemplaza alert(), confirm() y maneja todos los modales
     */
    
    // Namespace global para PrestaLabs
    window.PrestaLabs = window.PrestaLabs || {};
    
    // Sistema de Popups
    PrestaLabs.Popup = {
        
        // Instancias de modales (cache)
        _modals: {},
        
        // Inicializar modales (lazy loading)
        _getModal: function(tipo) {
            if (!this._modals[tipo]) {
                const element = document.getElementById('modal' + tipo.charAt(0).toUpperCase() + tipo.slice(1));
                if (element) {
                    this._modals[tipo] = new bootstrap.Modal(element, {
                        backdrop: 'static',
                        keyboard: false
                    });
                }
            }
            return this._modals[tipo];
        },
        
        // Confirmar acción (reemplaza confirm())
        confirmar: function(mensaje, onConfirm, onCancel, opciones = {}) {
            const titulo = opciones.titulo || 'Confirmación';
            const textoConfirmar = opciones.textoConfirmar || 'Confirmar';
            const textoCancelar = opciones.textoCancelar || 'Cancelar';
            const tipoBoton = opciones.tipoBoton || 'primary';
            
            // Configurar contenido
            document.getElementById('modalConfirmacionTitulo').innerHTML = `
                <i class="bi bi-question-circle me-2"></i>${titulo}
            `;
            document.getElementById('modalConfirmacionMensaje').textContent = mensaje;
            document.getElementById('btnConfirmar').textContent = textoConfirmar;
            document.getElementById('btnConfirmar').className = `btn btn-${tipoBoton}`;
            document.getElementById('btnCancelar').textContent = textoCancelar;
            
            // Limpiar eventos previos
            const btnConfirmar = document.getElementById('btnConfirmar');
            const btnCancelar = document.getElementById('btnCancelar');
            const newBtnConfirmar = btnConfirmar.cloneNode(true);
            const newBtnCancelar = btnCancelar.cloneNode(true);
            btnConfirmar.parentNode.replaceChild(newBtnConfirmar, btnConfirmar);
            btnCancelar.parentNode.replaceChild(newBtnCancelar, btnCancelar);
            
            // Configurar eventos
            newBtnConfirmar.addEventListener('click', function() {
                PrestaLabs.Popup._getModal('confirmacion').hide();
                if (onConfirm && typeof onConfirm === 'function') {
                    onConfirm();
                }
            });
            
            newBtnCancelar.addEventListener('click', function() {
                PrestaLabs.Popup._getModal('confirmacion').hide();
                if (onCancel && typeof onCancel === 'function') {
                    onCancel();
                }
            });
            
            // Mostrar modal
            this._getModal('confirmacion').show();
        },
        
        // Mostrar alerta informativa (reemplaza alert())
        alerta: function(mensaje, onClose, opciones = {}) {
            const titulo = opciones.titulo || 'Información';
            const textoBoton = opciones.textoBoton || 'OK';
            
            // Configurar contenido
            document.getElementById('modalAlertaTitulo').innerHTML = `
                <i class="bi bi-info-circle me-2"></i>${titulo}
            `;
            document.getElementById('modalAlertaMensaje').textContent = mensaje;
            document.getElementById('btnAlertaOK').textContent = textoBoton;
            
            // Limpiar eventos previos
            const btnOK = document.getElementById('btnAlertaOK');
            const newBtnOK = btnOK.cloneNode(true);
            btnOK.parentNode.replaceChild(newBtnOK, btnOK);
            
            // Configurar evento
            newBtnOK.addEventListener('click', function() {
                PrestaLabs.Popup._getModal('alerta').hide();
                if (onClose && typeof onClose === 'function') {
                    onClose();
                }
            });
            
            // Mostrar modal
            this._getModal('alerta').show();
        },
        
        // Mostrar mensaje de éxito
        exito: function(mensaje, onClose, opciones = {}) {
            const titulo = opciones.titulo || 'Éxito';
            const textoBoton = opciones.textoBoton || 'OK';
            
            // Configurar contenido
            document.getElementById('modalExitoTitulo').innerHTML = `
                <i class="bi bi-check-circle me-2"></i>${titulo}
            `;
            document.getElementById('modalExitoMensaje').textContent = mensaje;
            document.getElementById('btnExitoOK').textContent = textoBoton;
            
            // Limpiar eventos previos
            const btnOK = document.getElementById('btnExitoOK');
            const newBtnOK = btnOK.cloneNode(true);
            btnOK.parentNode.replaceChild(newBtnOK, btnOK);
            
            // Configurar evento
            newBtnOK.addEventListener('click', function() {
                PrestaLabs.Popup._getModal('exito').hide();
                if (onClose && typeof onClose === 'function') {
                    onClose();
                }
            });
            
            
            // Mostrar modal
            this._getModal('exito').show();
        },
        
        // Mostrar mensaje de error
        error: function(mensaje, onClose, opciones = {}) {
            const titulo = opciones.titulo || 'Error';
            const textoBoton = opciones.textoBoton || 'OK';
            
            // Configurar contenido
            document.getElementById('modalErrorTitulo').innerHTML = `
                <i class="bi bi-exclamation-triangle me-2"></i>${titulo}
            `;
            document.getElementById('modalErrorMensaje').textContent = mensaje;
            document.getElementById('btnErrorOK').textContent = textoBoton;
            
            // Limpiar eventos previos
            const btnOK = document.getElementById('btnErrorOK');
            const newBtnOK = btnOK.cloneNode(true);
            btnOK.parentNode.replaceChild(newBtnOK, btnOK);
            
            // Configurar evento
            newBtnOK.addEventListener('click', function() {
                PrestaLabs.Popup._getModal('error').hide();
                if (onClose && typeof onClose === 'function') {
                    onClose();
                }
            });
            
            // Mostrar modal
            this._getModal('error').show();
        },
        
        // Cerrar todos los modales
        cerrarTodos: function() {
            Object.keys(this._modals).forEach(tipo => {
                if (this._modals[tipo]) {
                    this._modals[tipo].hide();
                }
            });
        },
        
        // Verificar si hay modales abiertos
        hayModalAbierto: function() {
            return document.querySelectorAll('.modal.show').length > 0;
        }
    };
    
    // Aliases para retrocompatibilidad gradual
    PrestaLabs.confirm = PrestaLabs.Popup.confirmar;
    PrestaLabs.alert = PrestaLabs.Popup.alerta;
    PrestaLabs.success = PrestaLabs.Popup.exito;
    PrestaLabs.error = PrestaLabs.Popup.error;
    
    // Sistema de interceptación opcional para migración gradual
    PrestaLabs.Popup.interceptar = {
        alert: function(activar = true) {
            if (activar && !window._alertOriginal) {
                window._alertOriginal = window.alert;
                window.alert = function(mensaje) {
                    PrestaLabs.Popup.alerta(mensaje);
                };
            } else if (!activar && window._alertOriginal) {
                window.alert = window._alertOriginal;
                delete window._alertOriginal;
            }
        },
        
        confirm: function(activar = true) {
            if (activar && !window._confirmOriginal) {
                window._confirmOriginal = window.confirm;
                window.confirm = function(mensaje, onConfirm) {
                    PrestaLabs.Popup.confirmar(mensaje, 
                        () => onConfirm && onConfirm(true),
                        () => onConfirm && onConfirm(false)
                    );
                    return false; // Para evitar ejecución inmediata
                };
            } else if (!activar && window._confirmOriginal) {
                window.confirm = window._confirmOriginal;
                delete window._confirmOriginal;
            }
        }
    };
    
    // Inicialización
    document.addEventListener('DOMContentLoaded', function() {
        // Opcional: Activar interceptación automática
        // PrestaLabs.Popup.interceptar.alert(true);
        // PrestaLabs.Popup.interceptar.confirm(true);
        
        console.log('✅ Sistema de Popups PrestaLabs inicializado');
    });
    
    </script>

    <footer class="footer mt-auto">
        <div class="container py-2">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 mx-auto text-center">
                    <div class="footer-minimal animate-footer">
                        <span class="footer-mail-text">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 32 20" style="vertical-align:middle; margin-right:6px; border-radius:2px; box-shadow:0 1px 4px rgba(36,44,79,0.10);">
                                <rect width="32" height="20" rx="2" fill="#74ACDF"/>
                                <rect y="6" width="32" height="8" fill="#fff"/>
                                <circle cx="16" cy="10" r="3.2" fill="#FFD600" stroke="#74ACDF" stroke-width="1.2"/>
                            </svg>
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="var(--color-amarillo)" class="bi bi-envelope-fill mb-1" viewBox="0 0 16 16" style="vertical-align:middle; margin-right:6px;">
                                <path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.651L0 4.697ZM6.761 8.83l-6.57 4.134A2 2 0 0 0 2 14h12a2 2 0 0 0 1.809-1.036l-6.57-4.134L8 9.586l-1.239-.757ZM16 4.697l-5.803 3.456L16 11.801V4.697Z"/>
                            </svg>
                            apresta@sicyt.gob.ar
                        </span>
                        <span class="footer-info-title">Subsecretaría de Tecnología de la información y las comunicaciones</span>
                        <span class="footer-info-title">Secretaría de Innovación, ciencia y tecnología</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>